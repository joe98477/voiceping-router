---
phase: 03-browser-ui-for-general-users
plan: 04
type: execute
wave: 4
depends_on: ["03-03"]
files_modified:
  - web-ui/src/pages/Channels.jsx
  - web-ui/src/components/ChannelCard.jsx
  - web-ui/src/styles.css
autonomous: false

must_haves:
  truths:
    - "Vite dev server starts without errors"
    - "Build completes without errors"
    - "Session token persists across page refresh"
    - "Channel list renders for authenticated user"
  artifacts:
    - path: "web-ui/src/pages/Channels.jsx"
      provides: "Working Channels page"
    - path: "web-ui/src/components/ChannelCard.jsx"
      provides: "Working channel card with PTT integration"
  key_links:
    - from: "web-ui/src/App.jsx"
      to: "web-ui/src/pages/Channels.jsx"
      via: "React Router /event/:eventId/channels"
      pattern: "/channels"
---

<objective>
Verify the complete Phase 3 UI works end-to-end: build succeeds, dev server starts, routing works, and fix any integration issues discovered during verification.

Purpose: Integration verification catches issues that individual plan executions miss -- import path problems, CSS conflicts, runtime errors. This plan fixes issues and gets user confirmation.

Output: Working build, verified routing, and user sign-off on the UI.
</objective>

<execution_context>
@C:\Users\jotha\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\jotha\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-browser-ui-for-general-users/03-01-SUMMARY.md
@.planning/phases/03-browser-ui-for-general-users/03-02-SUMMARY.md
@.planning/phases/03-browser-ui-for-general-users/03-03-SUMMARY.md
@web-ui/src/App.jsx
@web-ui/src/pages/Channels.jsx
@web-ui/src/components/ChannelList.jsx
@web-ui/src/components/ChannelCard.jsx
@web-ui/src/hooks/useAuth.js
@web-ui/src/hooks/useChannelConnection.js
@web-ui/src/context/ChannelContext.jsx
@web-ui/src/utils/tokenStorage.js
@web-ui/src/styles.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build verification and integration fixes</name>
  <files>
    web-ui/src/pages/Channels.jsx
    web-ui/src/components/ChannelCard.jsx
    web-ui/src/styles.css
  </files>
  <action>
Run the following verifications and fix any issues found:

1. **Build check:**
   ```bash
   cd web-ui && npm run build
   ```
   If build fails, diagnose and fix:
   - Import path issues (especially src/client/ TypeScript imports from web-ui)
   - Missing exports or circular dependencies
   - JSX syntax errors
   - CSS syntax errors

2. **Dev server check:**
   ```bash
   cd web-ui && npm run dev
   ```
   Verify it starts without errors. Check terminal output for warnings.

3. **Import resolution check:**
   Verify all imports resolve correctly:
   - ChannelCard imports from useChannelConnection
   - ChannelList imports from ChannelCard and ChannelContext
   - Channels page imports from ChannelList, ChannelProvider, useAuth, api
   - App.jsx imports from Channels page

4. **Consistency check:**
   - Verify all new files use .jsx extension (matching existing convention)
   - Verify double quotes used (matching ESLint config)
   - Verify import paths use relative format with .jsx/.js extensions (matching existing App.jsx pattern)

5. **Runtime check:**
   - Ensure no `undefined is not a function` or `Cannot read property` errors at import time
   - Verify React hooks rules not violated (no hooks in conditionals)
   - Check that useEffect dependency arrays are complete

Fix all issues found. The goal is a clean build and clean dev server startup.

If there are fundamental issues with importing TypeScript modules from src/client/ in the web-ui Vite build, implement the fallback approach:
- Create a thin JavaScript adapter layer in web-ui/src/utils/ that wraps the needed functionality
- OR adjust Vite config to support TypeScript path resolution to src/client/
  </action>
  <verify>
    1. `cd web-ui && npm run build` exits 0 with no errors
    2. `cd web-ui && npm run dev` starts successfully
    3. No ESLint warnings about hooks rules
    4. All imports resolve
  </verify>
  <done>
    web-ui builds successfully and dev server starts without errors. All import paths resolve correctly. Any integration issues between web-ui and src/client/ TypeScript modules are resolved.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete Phase 3 Browser UI for General Users:
    - /event/:eventId/channels page showing assigned channels
    - Each channel card with PTT button, busy indicator, and speaker display
    - Session persistence across page refresh (SEC-04)
    - PERMISSION_UPDATE handling for dynamic channel list updates
    - Responsive CSS grid layout
    - Route wiring in App.jsx with auth protection
    - "My Channels" link on Events page
  </what-built>
  <how-to-verify>
    1. Start the control-plane, router server, and web-ui dev server
    2. Log in as a general user (or any user with channel assignments)
    3. Navigate to Events page -- verify "My Channels" link appears
    4. Click "My Channels" -- verify channel list loads
    5. Verify each channel card shows:
       - Channel name/ID
       - Connection status (should transition to "connected")
       - PTT button (hold to talk)
    6. Press and hold a PTT button -- verify it activates (transmitting state)
    7. Release -- verify it returns to idle
    8. If another user transmits on a channel, verify:
       - Channel shows "busy" indicator (UI-03)
       - Speaker name displayed (UI-04)
    9. Refresh the page -- verify session persists (SEC-04), no re-login required
    10. Verify responsive layout: resize browser to check 1/2/3 column grid
    11. Log out -- verify redirect to login page
  </how-to-verify>
  <resume-signal>Type "approved" if the UI works correctly, or describe any issues that need fixing.</resume-signal>
</task>

</tasks>

<verification>
1. Build completes: `cd web-ui && npm run build` exits 0
2. Dev server starts: `cd web-ui && npm run dev` shows no errors
3. All Phase 3 success criteria met (UI-01 through UI-04, SEC-04)
4. User has verified the complete flow
</verification>

<success_criteria>
- Clean build with zero errors
- Dev server starts successfully
- User confirms:
  - Channel list renders (UI-01)
  - PTT button works on each channel (UI-02)
  - Busy state indicator visible (UI-03)
  - Speaker name displayed (UI-04)
  - Session persists across refresh (SEC-04)
</success_criteria>

<output>
After completion, create `.planning/phases/03-browser-ui-for-general-users/03-04-SUMMARY.md`
</output>
