---
phase: 06-single-channel-ptt-audio
plan: 05
type: execute
wave: 3
depends_on: ["06-03", "06-04"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User can press and hold PTT button to transmit audio on a channel (APTT-01)"
    - "User can release PTT button to stop transmission (APTT-02)"
    - "User sees busy state when channel is occupied with speaker name (APTT-03)"
    - "User hears received audio from monitored channel (APTT-04)"
    - "User sees speaker name and animated indicator for active transmissions (APTT-05)"
    - "User gets PTT feedback: start tone, roger beep, haptic (APTT-06)"
    - "User can toggle between earpiece and speaker audio output (AUD-01)"
  artifacts: []
  key_links: []
---

<objective>
Verify all Phase 6 success criteria on device: PTT transmission, busy state, speaker indicators, audio feedback tones, haptic feedback, settings controls.

Purpose: Phase 6 involves real-time audio, hardware interaction (microphone, speaker, vibrator), and server communication that can only be verified on an actual device or emulator with the server running.

Output: Human verification of all 7 success criteria.
</objective>

<execution_context>
@/home/earthworm/.claude/get-shit-done/workflows/execute-plan.md
@/home/earthworm/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-single-channel-ptt-audio/06-CONTEXT.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 1: Verify complete PTT transmission and feedback on device</name>
  <files></files>
  <action>
    Build the app and run verification. This is a human-verify checkpoint -- no code changes, only verification.

    Setup: Start server (docker compose up), build and install app on device/emulator (cd android and ./gradlew installDebug).

    1. PTT Transmission (APTT-01, APTT-02):
    a. Login, select event, join a channel
    b. Press and hold PTT button in bottom bar
    c. Verify: Button shows subtle loading pulse briefly (requesting state)
    d. Verify: Button turns red with pulsing animation + elapsed time counter
    e. Speak into mic
    f. From web client on same channel: verify audio is received
    g. Release PTT button
    h. Verify: Button returns to cyan idle state

    2. Busy State (APTT-03):
    a. From web client: press PTT on same channel
    b. On Android: verify PTT button is dimmed/grayed out
    c. On Android: verify bottom bar shows web user's name in cyan
    d. On Android: attempt to press PTT -- verify error tone + haptic buzz (no toast per decision)

    3. Audio Receive (APTT-04):
    a. From web client: transmit audio on same channel
    b. On Android: verify audio plays through device speaker (or earpiece if set)

    4. Speaker Indicators (APTT-05):
    a. From web client: start transmitting
    b. Verify: Channel row shows speaker name replacing idle text
    c. Verify: Channel row has cyan border/glow animation
    d. Verify: Speaker name pulses/glows in cyan
    e. Web client stops transmitting
    f. Verify: Speaker name fades out over 2-3 seconds
    g. Verify: Channel row returns to normal state (no border)

    5. PTT Feedback Tones (APTT-06):
    a. Press PTT: verify short chirp sound (PTT start tone)
    b. Press PTT: verify haptic click feedback
    c. Release PTT: verify roger beep sound
    d. Open settings drawer, toggle off PTT Start Tone
    e. Press PTT again: verify NO chirp sound, but haptic still works
    f. Toggle off Roger Beep, verify no roger beep on release
    g. Toggle on RX Squelch, have web client transmit, verify squelch open sound
    h. Web client stops, verify squelch close sound

    6. Audio Output (AUD-01):
    a. Open settings drawer, verify Audio Output section
    b. Select Earpiece, have web client transmit, verify audio through earpiece
    c. Select Speaker, verify audio through loudspeaker

    7. PTT Mode Toggle:
    a. Open settings drawer, select Toggle PTT mode
    b. Single tap PTT button, verify transmission starts
    c. Single tap again, verify transmission stops
    d. Verify max duration slider appears when Toggle mode selected
    e. Switch back to Press and Hold, verify hold behavior restored
  </action>
  <verify>Human confirms all 7 Phase 6 success criteria pass on device. Type "approved" if all pass, or describe specific issues for gap closure.</verify>
  <done>All Phase 6 success criteria verified: APTT-01 through APTT-06 and AUD-01 confirmed working on Android device with server running.</done>
</task>

</tasks>

<verification>
All 7 Phase 6 success criteria verified on device:
1. APTT-01: Press and hold PTT transmits audio
2. APTT-02: Release stops transmission
3. APTT-03: Busy state shows speaker name + dimmed button
4. APTT-04: Received audio plays through speaker/earpiece
5. APTT-05: Speaker indicators with animations in channel list
6. APTT-06: Audio + haptic feedback on PTT events
7. AUD-01: Earpiece/speaker toggle works
</verification>

<success_criteria>
Human verifies all 7 success criteria pass on Android device with server running. PTT audio flows bidirectionally. Settings persist and apply correctly.
</success_criteria>

<output>
After completion, create `.planning/phases/06-single-channel-ptt-audio/06-05-SUMMARY.md`
</output>
